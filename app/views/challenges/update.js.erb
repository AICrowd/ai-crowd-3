function handleChallengeUpdate() {
  const errorMessage                  = "<%= @challenge.errors.full_messages.to_sentence.html_safe %>";
  const challengesFormErrorsParagraph = document.getElementById('challenges-form-errors');
  const flashMessagesWrapper          = document.getElementById('flash-messages-wrapper');
  const detailFormCardImage           = document.getElementById('challenges-form-card-image');
  const removeCardImageLink           = document.getElementById('challenges-form-remove-card-image');
  const nextTab                       = "<%= params[:next_tab] %>";
  const isCardImagePresent            = "<%= @challenge.image_file.present? %>";
  const overviewFormPartnerImagesUrls = <%= @challenge.challenge_partners.map { |challenge_partner| asset_url(challenge_partner.image_file&.url.to_s) }.to_json.html_safe %>;
  const overviewFormPartnerImagesIds  = <%= @challenge.challenge_partners.pluck(:id) %>
  const roundsFormRoundsIds           = <%= @challenge.challenge_rounds.pluck(:id) %>

  // Refresh Card Image
  detailFormCardImage.setAttribute('src', '<%= asset_url(@challenge.image_file&.url.to_s) %>');
  // Show Remove Card Image link
  if (isCardImagePresent === 'true') {
    removeCardImageLink.classList.remove('challenges-form__link--hidden');
  }
  // Refresh Partner Images
  document.querySelectorAll('.challenges-form-partner-image').forEach(function(element, index) {
    const imageUrl = overviewFormPartnerImagesUrls[index]
    if (imageUrl) { element.setAttribute('src', imageUrl); }
  });
  // Set Id of each partner challenge association to prevent duplications
  document.querySelectorAll('.challenges-form-partner-id').forEach(function(element, index) {
    const imageId = overviewFormPartnerImagesIds[index];
    if (imageId) { element.value = imageId; }
  });
  // Set Id of each round to prevent association duplication
  document.querySelectorAll('.challenges-form-round-id').forEach(function(element, index) {
    const roundId = roundsFormRoundsIds[index];
    if (roundId) { element.value = roundId; }
  });

  if (errorMessage.length) {
    flashMessagesWrapper.innerHTML = "<%= j render 'layouts/flash_message', type: 'error', message: 'Previous tab couldn\'t be saved because of errors. Please move back and correct the fields.' %>";
    setTimeout(function() { $('.flash-message').slideUp(500); }, 5000);
  } else {
    flashMessagesWrapper.innerHTML = "<%= j render 'layouts/flash_message', type: 'notice', message: 'Challenge saved.' %>";
    setTimeout(function() { $('.flash-message').slideUp(500); }, 1000);
  }

  if (nextTab.length) { // Form submitted by Update challenge button
    window.scrollTo(0, 0);
    setTimeout(function() { $(`#challenge-edit-${nextTab}-tab`).tab('show'); }, window.pageYOffset / 4);
  }
}

handleChallengeUpdate();
